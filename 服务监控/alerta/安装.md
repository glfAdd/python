## 服务端安装

##### github

```
https://github.com/alerta/alerta

文档:
https://docs.alerta.io/
```

##### 安装 MongoDB

##### git clone

```
$ git clone https://github.com/alerta/alerta.git
$ pip install -r requirements.txt
$ pip install python-dotenv
```

##### psycopg2 包安装失败

```
需要安装环境依赖
$ aptitude install libpq-dev python-dev
```

##### 运行

```
python wsgi.py
```

##### api doc

```
http://localhost:8080/
```

##### web ui

```
http://localhost:8000
```

##### 帐号设置

```
```

##  客户端

> 文档: https://github.com/alerta/python-alerta-client





## 发送消息

##### 文档

```
https://docs.alerta.io/cli.html#cli-send
```

##### 安装 alerta

```
pip install alerta
```

##### 帮助

```
 $ alerta send --help
Usage: alerta send [OPTIONS]

  Send an alert.

Options:
  -r, --resource RESOURCE        Resource under alarm
  -e, --event EVENT              Event name
  -E, --environment ENVIRONMENT  Environment eg. Production, Development
  -s, --severity SEVERITY        Severity eg. critical, major, minor, warning
  -C, --correlate EVENT          List of related events eg. node_up, node_down
  -S, --service SERVICE          List of affected services eg. app name, Web,
                                 Network, Storage, Database, Security
  -g, --group GROUP              Group event by type eg. OS, Performance
  -v, --value VALUE              Event value
  -t, --text DESCRIPTION         Description of alert
  -T, --tag TAG                  List of tags eg. London, os:linux, AWS/EC2
  -A, --attributes KEY=VALUE     List of attributes eg. priority=high
  -O, --origin ORIGIN            Origin of alert in form app/host
  --type EVENT_TYPE              Event type eg. exceptionAlert,
                                 performanceAlert, nagiosAlert
  --timeout SECONDS              Seconds before an open alert will be expired
  --raw-data STRING              Raw data of orignal alert eg. SNMP trap PDU.
                                 '@' to read from file, '-' to read from stdin
  --customer STRING              Customer
  -h, --help                     Show this message and exit.
```

##### 示例

> 可以用中文字符串
>
> severity只能是 security, critical, major, minor, warning, indeterminate, informational, normal, ok, cleared, debug, trace, unknown
>
> severity 为 ok 时没有消息
>
> 

```bash
$ alerta send -r web01 -e HttpError -g Web -s major --attributes region="EU"
$ alerta send --resource resource001 --event event001 --correlate correlate001 --group group001 --severity critical
$ alerta send --resource 来源002 --event 事件001 --correlate correlate001 --group group001 --severity debug
# 指定 url
$ alerta --endpoint-url http://localhost:8080 send --resource 来源002 --event 事件001 --correlate correlate001 --group group001 --severity debug 

```

​	

##### python sdk

```

```

## settings

> 文档: https://docs.alerta.io/configuration.html?highlight=email
>
> 文件位置: ./alerta/settings.py

##### 查看当前配置

```
$ alerta config
```



```



[DEFAULT]
timezone = Australia/Sydney
output = json

[profile development]
endpoint = https://localhost:8443
key = demo-key
sslverify = off
timeout = 10.0
debug = yes
```



## 发送通知

```
$ alerta send -E ... --attribute externalUrl='<a href="https://my.example.com/go?id=1234">ref 1234</a>'


Grafana
```

##### 邮件

```
文档
https://docs.alerta.io/integrations.html?highlight=email

https://docs.alerta.io/configuration.html?highlight=email

github
https://github.com/alerta/alerta-contrib/tree/master/integrations/mailer


prometheus


alerta --endpoint-url http://192.168.1.228:28880/api send --resource webserver01 --event down --environment Production --service Website01 --severity major --text "Web server 01 is down." --value ERROR





$ alerta --endpoint-url http://127.0.0.1:8000/api send --resource 来源003 --event 事件003 --correlate correlate003 --group group003 --severity debug

--endpoint-url



```

##### 丁丁通知

```
https://github.com/alerta/alerta-contrib/blob/master/plugins/dingtalk/dingtalkchatbot/chatbot.py
```

